name: acceptance-tests
on:
  pull_request:
    branches:
      - main
    paths:
      - .github/workflows/acctests.yml
      - illumio-core/*.go
      - scripts/acccoveragecheck.sh
jobs:
  acctests:
    runs-on: ubuntu-latest
    steps:
      -
        name: Checkout
        uses: actions/checkout@v2
      -
        name: Unshallow
        run: git fetch --prune --unshallow
      -
        name: Set up Go
        uses: actions/setup-go@v2
        with:
          go-version: 1.16
      -
        name: Run Acc. Tests
        run: bash scripts/acccoveragecheck.sh
        env:
          CGO_ENABLED: 0
          ACC_TEST_COV_THRESHOLD: 70
          # Required to run acc tests successfully
          # TODO set below env vars in secrets
          # TF_ACC: 1
          # ILLUMIO_PCE_HOST: ${{ secrets.ACC_TEST_ILLUMIO_PCE_HOST }}
          # ILLUMIO_API_KEY_USERNAME: ${{ secrets.ACC_TEST_ILLUMIO_API_KEY_USERNAME }}
          # ILLUMIO_API_KEY_SECRET: ${{ secrets.ACC_TEST_ILLUMIO_API_KEY_SECRET }}
          # ILLUMIO_AES_GCM_KEY: ${{ secrets.ACC_TEST_ILLUMIO_AES_GCM_KEY }}